<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Ditherbooth</title>
    <link rel="stylesheet" href="/static/style.css" />
    <link rel="preload" href="/static/examples/original.png" as="image">
    <link rel="preload" href="/static/examples/final_1bit_463.png" as="image">
    <link rel="icon" href="data:,">
    <meta name="color-scheme" content="light dark">
    <meta name="theme-color" content="#111">
    <meta name="description" content="Simple photo-to-label printer UI">
</head>
<body>
    <header class="app-header">
        <h1>Ditherbooth</h1>
        <nav style="margin-left:auto; display:flex; gap:8px; align-items:center;">
          <button id="settingsBtn" class="icon-btn" title="Settings" aria-label="Settings">⚙️</button>
        </nav>
    </header>

    <!-- Tab Bar -->
    <nav class="tab-bar" id="tabBar">
        <button class="tab active" data-tab="photo">Photo</button>
        <button class="tab" data-tab="designer">Designer</button>
    </nav>

    <!-- Photo Tab (existing flow) -->
    <main class="container layout tab-content active" id="tab-photo">
        <section id="uploaderSection" class="uploader card">
            <div id="dropArea" class="drop-area" tabindex="0" aria-label="Drop image here or click to select">
                <div id="preview" class="preview">
                    <span class="placeholder">Drop an image or click to choose</span>
                </div>
                <input type="file" id="file" accept="image/*" hidden>
            </div>
            <div class="actions">
                <button id="chooseBtn" class="secondary">Choose Image</button>
                <button id="sampleBtn" class="secondary">Use Sample Image</button>
                <button id="printBtn" class="primary">Print</button>
            </div>
            <div id="status" class="status" role="status" aria-live="polite"></div>
        </section>

        <aside class="card">
            <div id="controls" class="controls">
                <label>
                    Media
                    <select id="media">
                        <option value="continuous58">58mm continuous</option>
                        <option value="continuous80">80mm continuous</option>
                        <option value="label50x30">50x30 label</option>
                        <option value="label100x150">100x150 label</option>
                        <option value="label55x30">55x30 label</option>
                    </select>
                </label>
                <label>
                    Language
                    <select id="lang">
                        <option value="EPL">EPL</option>
                        <option value="ZPL">ZPL</option>
                    </select>
                </label>
            </div>
            <div class="card">
                <h3>Output Preview</h3>
                <div id="outputFrame" class="output-frame roll">
                    <canvas id="outputCanvas"></canvas>
                </div>
                <div class="actions" id="outputActions"></div>
                <div class="status" id="outputMsg"></div>
            </div>
        </aside>
    </main>

    <!-- Designer Tab -->
    <div class="container tab-content" id="tab-designer">
        <div class="designer-toolbar">
            <button id="dAddText" class="secondary">Add Text</button>
            <label class="toolbar-label">
                Size
                <input type="number" id="dFontSize" value="40" min="8" max="300" step="1" class="toolbar-input">
            </label>
            <label class="toolbar-label">
                Media
                <select id="dMedia" class="toolbar-select"></select>
            </label>
            <button id="dGrid" class="secondary">Grid: On</button>
            <label class="toolbar-label">
                Grid
                <input type="number" id="dGridSize" value="20" min="5" max="100" step="5" class="toolbar-input">
            </label>
            <div style="margin-left:auto; display:flex; gap:8px; flex-wrap:wrap;">
                <button id="dDelete" class="secondary">Delete</button>
                <button id="dPreview" class="secondary">Preview</button>
                <button id="dPrint" class="primary">Print</button>
            </div>
        </div>
        <div class="designer-canvas-wrap">
            <canvas id="designerCanvas"></canvas>
        </div>
        <div id="dPreviewFrame" class="output-frame roll" style="display:none;">
            <img id="dPreviewImg" style="max-width:100%; image-rendering:pixelated;">
        </div>
        <div id="dStatus" class="status" role="status" aria-live="polite"></div>

        <!-- Templates -->
        <div class="designer-templates">
            <div class="actions">
                <button id="dSave" class="secondary">Save Template</button>
                <button id="dLoadList" class="secondary">Load Template</button>
            </div>
            <div id="dTemplateList" class="template-list" hidden></div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal" aria-hidden="true" role="dialog" aria-labelledby="settingsTitle">
        <div class="modal-content">
            <header class="modal-header">
                <h2 id="settingsTitle">Developer Settings</h2>
                <button id="closeModal" class="icon-btn" aria-label="Close">✖️</button>
            </header>
            <section class="modal-body">
                <div class="field">
                    <label>Dev Password
                        <input type="password" id="devPassword" placeholder="Enter password" autocomplete="current-password">
                    </label>
                    <button id="connectSettings" class="secondary">Connect</button>
                </div>
                <div id="settingsForm" class="settings-form" hidden>
                    <div class="field">
                        <label><input type="checkbox" id="testMode"> Test mode (don't print)</label>
                    </div>
                    <div class="field">
                        <label>Test mode delay (ms)
                            <input type="number" id="testDelay" min="0" step="100" placeholder="e.g., 1500">
                        </label>
                    </div>
                    <div class="field">
                        <label><input type="checkbox" id="lockControls"> Lock user controls</label>
                    </div>
                    <div class="field">
                        <label><input type="checkbox" id="designMode"> Enable label design mode</label>
                    </div>
                    <div class="field">
                        <label>Default media
                            <select id="defMedia">
                                <option value="continuous58">58mm continuous</option>
                                <option value="continuous80">80mm continuous</option>
                                <option value="label50x30">50x30 label</option>
                                <option value="label100x150">100x150 label</option>
                                <option value="label55x30">55x30 label</option>
                            </select>
                        </label>
                    </div>
                    <div class="field">
                        <label>Default language
                            <select id="defLang">
                                <option value="EPL">EPL</option>
                                <option value="ZPL">ZPL</option>
                            </select>
                        </label>
                    </div>
                    <div class="field">
                        <label>EPL Darkness (0-15)
                            <input type="number" id="eplDarkness" min="0" max="15" step="1" placeholder="e.g., 8">
                        </label>
                    </div>
                    <div class="field">
                        <label>EPL Speed (1-6)
                            <input type="number" id="eplSpeed" min="1" max="6" step="1" placeholder="e.g., 2">
                        </label>
                    </div>
                    <div class="field">
                        <label>Printer name (optional override)
                            <input type="text" id="printerName" placeholder="e.g., Zebra_LP2844">
                        </label>
                    </div>
                    <div class="actions end">
                        <button id="saveSettings" class="primary">Save</button>
                    </div>
                </div>
                <div id="settingsMsg" class="status"></div>
            </section>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>
    <script src="/static/app.js" defer></script>
    <script src="/static/designer-v2.js" defer></script>
    <noscript>This app requires JavaScript.</noscript>
</body>
</html>
